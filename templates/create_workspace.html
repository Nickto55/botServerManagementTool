{% extends 'layout.html' %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <h3>Создать Workspace для бота</h3>
    
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    
    <div class="card">
      <div class="card-body">
        <form method="post">
          <div class="mb-3">
            <label class="form-label">Имя Workspace <span class="text-danger">*</span></label>
            <input class="form-control" name="workspace_name" required 
                   placeholder="my-bot" pattern="[a-zA-Z0-9_-]+" 
                   title="Только латинские буквы, цифры, дефисы и подчёркивания">
            <div class="form-text">Только латинские буквы, цифры, дефисы и подчёркивания</div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Базовый Docker образ</label>
            <select class="form-select" name="base_image">
              <option value="">По умолчанию (python:3.11-slim)</option>
              {% for image in available_images %}
                <option value="{{ image }}">{{ image }}</option>
              {% endfor %}
            </select>
            <div class="form-text">Выберите базовый образ для контейнера</div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <label class="form-label">Внутренний порт (опционально)</label>
              <input class="form-control" name="port_internal" type="number" 
                     placeholder="8000" min="1" max="65535">
            </div>
            <div class="col-md-6">
              <label class="form-label">Внешний порт (опционально)</label>
              <input class="form-control" name="port_external" type="number" 
                     placeholder="8000" min="1024" max="65535">
            </div>
          </div>
          <div class="form-text mb-3">Настройка проброса портов для веб-сервисов</div>
          
          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">
              <i class="fas fa-plus"></i> Создать Workspace
            </button>
            <a href="/" class="btn btn-secondary">Отмена</a>
          </div>
        </form>
      </div>
    </div>
    
    <div class="mt-4">
      <h5>Что создаётся:</h5>
      <ul class="list-unstyled">
        <li><i class="fas fa-folder text-primary"></i> Каталог workspace в <code>/bots/имя_workspace/</code></li>
        <li><i class="fas fa-file-code text-info"></i> Базовые файлы: <code>main.py</code>, <code>requirements.txt</code>, <code>README.md</code></li>
        <li><i class="fas fa-cube text-success"></i> Docker контейнер с выбранным образом</li>
        <li><i class="fas fa-terminal text-warning"></i> Готовая среда для разработки бота</li>
      </ul>
    </div>
  </div>
</div>

<script>
// Автоматическое заполнение внешнего порта при изменении внутреннего
document.querySelector('input[name="port_internal"]').addEventListener('input', function() {
  const external = document.querySelector('input[name="port_external"]');
  if (!external.value && this.value) {
    external.value = this.value;
  }
});
</script>
{% endblock %}